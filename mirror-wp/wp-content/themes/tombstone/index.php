<?php get_header(); ?>

  <section class="grid gtc-6 ptb-60">
    <h1 class="lh-80 fs-210 uppercase col-1-6">Монумент</h1>
    <h2 class="fs-48 fw-100 col-1-4 ptb-40">ИЗГОТОВЛЕНИЕ И УСТАНОВКА НАДГРОБНЫХ ПАМЯТНИКОВ В&nbsp;ТЮМЕНИ</h2>
    <div class="col-5-2 bird"><img src="<? echo get_stylesheet_directory_uri() . '/assets/images/bird.png' ?>" alt=""></div>
    <div class="col-1-3">
      <button class="btn-1 uppercase button-with-arrow">Конструктор</button>
    </div>
  </section>

  <section id="shares" class="ptb-60">
    
    <h2 class="cercle bg-gray">Акции</h2>
    
      <div class="swiper mt-70">
        <div class="swiper-wrapper">
          <!-- <div class="swiper-slide">
            <div class="grid gtc-2 carousel">
              <div class="col-1-1 p-60">
                <h3 class="lh-115">Памятник для участников <span>СВО</span></h3>
                <p class="mt-100 ff-osc-l fs-24">тексттексттексттексттекст тексттексттексттекст текст тексттекст тексттекст тексттексттексттексттексттексттексттексттексттекст тексттексттексттексттекс ттексттексттексттексттексттекс ттексттексттексттексттексттексттексттексттекст</p>
              </div>
              <div class="col-2-1" style="background-image: url('<?php echo get_stylesheet_directory_uri() . '/assets/images/carousel-img-1.jpg' ?>');"></div>
            </div>
          </div> -->
          <div class="swiper-slide">
            <div class="grid gtc-2 carousel">
              <div class="col-1-1 p-60">
                <h3 class="lh-115">Гравировка в подарок<span></span></h3>
                <p class="mt-100 ff-osc-l fs-24">Гравировка портрета, ФИО, дат, религиозной символики, эпитафий - в подарок при заказе от 120 000 рублей. От 150 000 бонусом гравировка на задней части стелы</p>
              </div>
              <div class="col-2-1" style="background-image: url('<?php echo get_stylesheet_directory_uri() . '/assets/images/carousel-img-2.jpg' ?>');"></div>
            </div>
          </div>
          <div class="swiper-slide">
            <div class="grid gtc-2 carousel">
              <div class="col-1-1 p-60">
                <h3 class="lh-115">два клининга в подарок <span></span></h3>
                <p class="mt-100 ff-osc-l fs-24">При заказе памятника вы получите два бесплатных обслуживания захоронения в течение года. Мы аккуратно очистим памятник, цветник и прилегающую территорию от мусора, пыли и листвы</p>
              </div>
              <div class="col-2-1" style="background-image: url('<?php echo get_stylesheet_directory_uri() . '/assets/images/carousel-img-3.jpg' ?>');"></div>
            </div>
          </div>
          <div class="swiper-slide">
            <div class="grid gtc-2 carousel">
              <div class="col-1-1 p-60">
                <h3 class="lh-115">детские памятники со скидкой 50% <span></span></h3>
                <p class="mt-100 ff-osc-l fs-24">Мы понимаем всю боль утраты и хотим помочь семьям в этот сложный момент. На все детские памятники предоставляется скидка 50%. Наши мастера изготовят работу с особым вниманием и заботой к каждой детали</p>
              </div>
              <div class="col-2-1" style="background-image: url('<?php echo get_stylesheet_directory_uri() . '/assets/images/carousel-img-4.jpg' ?>');"></div>
            </div>
          </div>
          <div class="swiper-slide">
            <div class="grid gtc-2 carousel">
              <div class="col-1-1 p-60">
                <h3 class="lh-115">Ретушь фото в подарок <span></span></h3>
                <p class="mt-100 ff-osc-l fs-24">При заказе гравировки портрета мы бесплатно выполним профессиональную ретушь фотографии. Исправим дефекты, улучшим качество изображения и подготовим его для переноса на камень</p>
              </div>
              <div class="col-2-1" style="background-image: url('<?php echo get_stylesheet_directory_uri() . '/assets/images/carousel-img-5.jpg' ?>');"></div>
            </div>
          </div>
          <div class="swiper-slide">
            <div class="grid gtc-2 carousel">
              <div class="col-1-1 p-60">
                <h3 class="lh-115">Сертификат на захоронение из реестра <span></span></h3>
                <p class="mt-100 ff-osc-l fs-24">Сертификат на захоронение из реестра со страницей памяти в подарок. Сохраните память о близких с помощью платформы ЮНАР ПАМЯТЬ, добавив на страницу памяти фото, видео, голос близкого человека</p>
              </div>
              <div class="col-2-1" style="background-image: url('<?php echo get_stylesheet_directory_uri() . '/assets/images/carousel-img-6.jpg' ?>');"></div>
            </div>
          </div>
          <div class="swiper-slide">
            <div class="grid gtc-2 carousel">
              <div class="col-1-1 p-60">
                <h3 class="lh-115">мраморная крошка в подарок <span></span></h3>
                <p class="mt-100 ff-osc-l fs-24">В подарок засыпка цветника мраморной крошкой или песком на выбор. Также за дополнительную плату доступен выстил цветника искуственным газоном</p>
              </div>
              <div class="col-2-1" style="background-image: url('<?php echo get_stylesheet_directory_uri() . '/assets/images/carousel-img-7.jpg' ?>');"></div>
            </div>
          </div>
          <div class="swiper-slide">
            <div class="grid gtc-2 carousel">
              <div class="col-1-1 p-60">
                <h3 class="lh-115">3 сертификата по 5000 рублей <span></span></h3>
                <p class="mt-100 ff-osc-l fs-24">Предоставляем клиентам 3 сертификата на сумму 5000 рублей каждый, которые можно использовать при будущих заказах. Подробности уточняйте у менеджера</p>
              </div>
              <div class="col-2-1" style="background-image: url('<?php echo get_stylesheet_directory_uri() . '/assets/images/carousel-img-8.jpg' ?>');"></div>
            </div>
          </div>

          
        </div>
        <div class="swiper-button-prev"></div>
        <div class="swiper-button-next"></div>
      </div>

  </section>

  <section class="ptb-60">  <!-- Block 3: Products -->
    <div class="tabs">
      <div class="tabs-nav ff-inter-700 fs-24">
        <div class="tab-link active">Участникам СВО</div>
        <div class="tab-link">Со скидкой</div>
        <div class="tab-link">Премиум</div>
      </div>

      <div class="tabs-content ">
        <div id="tab-1" class="tab-pane active">
          <div class="swiper-products-1 overflow-h mt-40">
            <div class="swiper-wrapper">

              <?php
                $args = array(
                    'post_type'      => 'product',
                    'posts_per_page' => 8,
                    'post_status'    => 'publish',
                    'tax_query'      => array(
                        array(
                            'taxonomy' => 'product_cat',
                            'field'    => 'slug',
                            'terms'    => 'svo',
                        ),
                    ),
                );

                $products = new WP_Query($args);

                if ($products->have_posts()) {
                  while ($products->have_posts()) {
                    $products->the_post();
                    global $product;
                    $product_id    = $product->get_id();
                    $price_regular = $product->get_regular_price();
                    $price_sale    = $product->get_sale_price();
                    $price_display = $product->get_price_html();
                    $product_link  = get_permalink($product->get_id());
                    $thumbnail     = get_the_post_thumbnail_url($product_id, 'medium');
                    ?>
                    <div class="swiper-slide">
                      <div class="card">
                        
                        <a class="wrap-img" href="<?php the_permalink(); ?>">
                            <img src="<?php echo esc_url( wp_get_attachment_url( $product->get_image_id() ) ); ?>" alt="<?php the_title(); ?>">
                        </a>
                        
                        <div class="product-card__info p-20">
                          <div class="product-card__title"><?php the_title(); ?></div>
                          <div class="product-card__bottom">
                            <div class="product-card__price price pt-20">
                              <?php
                                if ($product->is_type('variable')) {
                                  $prices = $product->get_variation_prices(true);

                                  // Минимальные цены
                                  $min_regular_price = current($prices['regular_price']);
                                  $min_sale_price    = current($prices['sale_price']);

                                  // Если есть скидка
                                  if ($min_sale_price && $min_sale_price < $min_regular_price) {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($min_sale_price) . '</div>';
                                    echo '<del class="price-old">' . wc_price($min_regular_price) . '</del>';
                                    echo '</span>';
                                  } else {
                                    // Без скидки
                                    echo '<span class="price">' . wc_price($min_regular_price) . '</span>';
                                  }

                                } else {
                                  // Для простых товаров
                                  if ($product->is_on_sale()) {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_sale_price()) . '</div>';
                                    echo '<del class="price-old">' . wc_price($product->get_regular_price()) . '</del> ';
                                    echo '</span>';
                                  } else {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_regular_price()) . '</div>';
                                    echo '<del class="price-old"></del> ';
                                    echo '</span>';
                                  }
                                }
                              ?>
                            </div>
                          </div>
                        </div>
                        <div><a class="btn-1" href="<?php the_permalink(); ?>">Подробнее</a></div>
                      </div>
                    </div>
                    <?php  
                  }
                  
                  wp_reset_postdata(); // Сбрасываем данные запроса
                    
                } else {
                  echo '<p>Товары не найдены</p>';
                }

                wp_reset_postdata();
              ?>

            </div>
          </div>
        </div>
        <div id="tab-2" class="tab-pane">
          <div class="swiper-products-1 overflow-h mt-40">
            <div class="swiper-wrapper">

              <?php
                $args = array(
                    'post_type'      => 'product',
                    'posts_per_page' => 8,
                    'post_status'    => 'publish',
                    'post__in'       => array_merge( array( 0 ), wc_get_product_ids_on_sale() )
                );

                $products = new WP_Query($args);

                if ($products->have_posts()) {
                  while ($products->have_posts()) {
                    $products->the_post();
                    global $product;
                    $product_id    = $product->get_id();
                    $price_regular = $product->get_regular_price();
                    $price_sale    = $product->get_sale_price();
                    $price_display = $product->get_price_html();
                    $product_link  = get_permalink($product->get_id());
                    $thumbnail     = get_the_post_thumbnail_url($product_id, 'medium');
                    ?>
                    <div class="swiper-slide">
                      <div class="card">
                        
                        <a class="wrap-img" href="<?php the_permalink(); ?>">
                            <img src="<?php echo esc_url( wp_get_attachment_url( $product->get_image_id() ) ); ?>" alt="<?php the_title(); ?>">
                        </a>
                        
                        <div class="product-card__info p-20">
                          <div class="product-card__title"><?php the_title(); ?></div>
                          <div class="product-card__bottom">
                            <div class="product-card__price price pt-20">
                              <?php
                                if ($product->is_type('variable')) {
                                  $prices = $product->get_variation_prices(true);

                                  // Минимальные цены
                                  $min_regular_price = current($prices['regular_price']);
                                  $min_sale_price    = current($prices['sale_price']);

                                  // Если есть скидка
                                  if ($min_sale_price && $min_sale_price < $min_regular_price) {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($min_sale_price) . '</div>';
                                    echo '<del class="price-old">' . wc_price($min_regular_price) . '</del>';
                                    echo '</span>';
                                  } else {
                                    // Без скидки
                                    echo '<span class="price">' . wc_price($min_regular_price) . '</span>';
                                  }

                                } else {
                                  // Для простых товаров
                                  if ($product->is_on_sale()) {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_sale_price()) . '</div>';
                                    echo '<del class="price-old">' . wc_price($product->get_regular_price()) . '</del> ';
                                    echo '</span>';
                                  } else {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_regular_price()) . '</div>';
                                    echo '<del class="price-old"></del> ';
                                    echo '</span>';
                                  }
                                }
                              ?>
                            </div>
                          </div>
                        </div>
                        <div><a class="btn-1" href="<?php the_permalink(); ?>">Подробнее</a></div>
                      </div>
                    </div>
                    <?php  
                  }
                  
                  wp_reset_postdata(); // Сбрасываем данные запроса
                    
                } else {
                  echo '<p>Товары не найдены</p>';
                }

                wp_reset_postdata();
              ?>

            </div>
          </div>
        </div>
        <div id="tab-3" class="tab-pane">
          <div class="swiper-products-1 overflow-h mt-40">
            <div class="swiper-wrapper">

              <?php
                $args = array(
                    'post_type'      => 'product',
                    'posts_per_page' => 8,
                    'post_status'    => 'publish',
                    'tax_query'      => array(
                        array(
                            'taxonomy' => 'product_cat',
                            'field'    => 'slug',
                            'terms'    => 'premium',
                        ),
                    ),
                );

                $products = new WP_Query($args);

                if ($products->have_posts()) {
                  while ($products->have_posts()) {
                    $products->the_post();
                    global $product;
                    $product_id    = $product->get_id();
                    $price_regular = $product->get_regular_price();
                    $price_sale    = $product->get_sale_price();
                    $price_display = $product->get_price_html();
                    $product_link  = get_permalink($product->get_id());
                    $thumbnail     = get_the_post_thumbnail_url($product_id, 'medium');
                    ?>
                    <div class="swiper-slide">
                      <div class="card">
                        
                        <a class="wrap-img" href="<?php the_permalink(); ?>">
                            <img src="<?php echo esc_url( wp_get_attachment_url( $product->get_image_id() ) ); ?>" alt="<?php the_title(); ?>">
                        </a>
                        
                        <div class="product-card__info p-20">
                          <div class="product-card__title"><?php the_title(); ?></div>
                          <div class="product-card__bottom">
                            <div class="product-card__price price pt-20">
                              <?php
                                if ($product->is_type('variable')) {
                                  $prices = $product->get_variation_prices(true);

                                  // Минимальные цены
                                  $min_regular_price = current($prices['regular_price']);
                                  $min_sale_price    = current($prices['sale_price']);

                                  // Если есть скидка
                                  if ($min_sale_price && $min_sale_price < $min_regular_price) {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($min_sale_price) . '</div>';
                                    echo '<del class="price-old">' . wc_price($min_regular_price) . '</del>';
                                    echo '</span>';
                                  } else {
                                    // Без скидки
                                    echo '<span class="price">' . wc_price($min_regular_price) . '</span>';
                                  }

                                } else {
                                  // Для простых товаров
                                  if ($product->is_on_sale()) {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_sale_price()) . '</div>';
                                    echo '<del class="price-old">' . wc_price($product->get_regular_price()) . '</del> ';
                                    echo '</span>';
                                  } else {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_regular_price()) . '</div>';
                                    echo '<del class="price-old"></del> ';
                                    echo '</span>';
                                  }
                                }
                              ?>
                            </div>
                          </div>
                        </div>
                        <div><a class="btn-1" href="<?php the_permalink(); ?>">Подробнее</a></div>
                      </div>
                    </div>
                    <?php  
                  }
                  
                  wp_reset_postdata(); // Сбрасываем данные запроса
                    
                } else {
                  echo '<p>Товары не найдены</p>';
                }

                wp_reset_postdata();
              ?>

            </div>
          </div>
        </div>
      </div>
    </div>            
  </section>

  <section id="about-us" class="ptb-60 bg-black full-width-bg">
    <h2 class="cercle cercle-orange txt-white">О нас</h2>
    <h3 class="txt-white pt-60">Изготавливаем и устанавливаем памятники из высококачественного чёрного гранита в Тюмени</h3>
    <div class="grid-even">
      <div class="grid gtc-2 gg-40 mt-60">
        <h4 class="txt-white">Полный цикл работ под ключ — изготовление, доставка, установка</h4>
        <p class="txt-white">Полный цикл работ — от разработки и согласования дизайна до установки памятника на месте захоронения. Работаем с российским, китайским, индийским, монгольским, иранским гранитом и мрамором, выполняем сложную ручную резку и художественную обработку</p>
      </div>
      <div class="grid gtc-2 gg-40 mt-60">
        <h4 class="txt-white">Изготовление в срок до трёх дней, установка — в течение десяти</h4>
        <p class="txt-white">Помимо продажи памятников и мемориальных комплексов, мы обустраиваем место захоронения: укладываем цветники (мраморная крошка, песок или искусственный газон), реализуем и устанавливаем металлические или гранитные оградки, лавочки, вазы, изготавливаем кованные цветы и орнаменты</p>
      </div>
      <div class="grid gtc-2 gg-40 mt-60">
        <h4 class="txt-white">Мы предоставляем гарантию на памятники сроком до 25 лет</h4>
        <p class="txt-white">Наши мастера выполняют гравировку портретов, эпитафий и дат, а также могут встроить в памятник изображение покойного на стекле. Бесплатно выполняем ретушь фотографий для наилучшего результата</p>
      </div>
    </div>
    <h3 class="txt-white pt-60">Мы ценим доверие наших клиентов и бережно подходим к каждой работе, понимая, насколько важно увековечить память близких</h3>
  </section>

  <section class="ptb-60">
    <h2 class="cercle bg-gray">Каталог</h2>

    <div class="tabs pt-30">
      <div class="tabs-nav ff-inter-700 fs-24">
        <div class="tab-link active">Участникам СВО</div>
        <div class="tab-link">Со скидкой</div>
        <div class="tab-link">Эконом</div>
      </div>

      <div class="tabs-content ">
        <div id="tab-1" class="tab-pane active">
          <div class="swiper-products-2 overflow-h mt-30">
            <div class="swiper-wrapper">

              <?php
                $args = array(
                    'post_type'      => 'product',
                    'posts_per_page' => 8, 
                    'post_status'    => 'publish',
                    'tax_query'      => array(
                        array(
                            'taxonomy' => 'product_cat',
                            'field'    => 'slug',
                            'terms'    => 'svo',
                        ),
                    ),
                );

                $products = new WP_Query($args);

                if ($products->have_posts()) {
                  while ($products->have_posts()) {
                    $products->the_post();
                    global $product;
                    $product_id    = $product->get_id();
                    $price_regular = $product->get_regular_price();
                    $price_sale    = $product->get_sale_price();
                    $price_display = $product->get_price_html();
                    $product_link  = get_permalink($product->get_id());
                    $thumbnail     = get_the_post_thumbnail_url($product_id, 'medium');
                    ?>
                    <div class="swiper-slide">
                      <div class="card">
                        <img src="<?php echo esc_url($thumbnail); ?>" alt="<?php the_title_attribute(); ?>">
                        
                        <div class="info p-20">
                          <div class="product-card__title"><?php the_title(); ?></div>
                          <?php
                            if ($product->is_type('variable')) {
                              $prices = $product->get_variation_prices(true);

                              // Минимальные цены
                              $min_regular_price = current($prices['regular_price']);
                              $min_sale_price    = current($prices['sale_price']);

                              // Если есть скидка
                              if ($min_sale_price && $min_sale_price < $min_regular_price) {
                                echo '<span class="price flex f-jc-sb f-ai-b">';
                                echo '<div class="price-new pt-10"><span class="fs-14">от</span>&nbsp;' . wc_price($min_sale_price) . '</div>';
                                echo '<del class="price-old">' . wc_price($min_regular_price) . '</del>';
                                echo '</span>';
                              } else {
                                // Без скидки
                                echo '<span class="price pt-10">' . wc_price($min_regular_price) . '</span>';
                              }

                            } else {
                              // Для простых товаров
                              if ($product->is_on_sale()) {
                                echo '<span class="price flex f-jc-sb f-ai-b">';
                                echo '<div class="price-new pt-10"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_sale_price()) . '</div>';
                                echo '<del class="price-old">' . wc_price($product->get_regular_price()) . '</del> ';
                                echo '</span>';
                              } else {
                                echo '<span class="price flex f-jc-sb f-ai-b">';
                                echo '<div class="price-new pt-10"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_regular_price()) . '</div>';
                                echo '<del class="price-old"></del> ';
                                echo '</span>';
                              }
                            }
                          ?>
                        </div>
                        <a href="<?php echo esc_url($product_link); ?>" class="card__btn ff-inter-700">Подробнее</a> 
                      </div>
                    </div>
                    <?php  
                  }
                  wp_reset_postdata();
                } else {
                  echo '<p>Товары не найдены</p>';
                }
              ?>
              
            </div>
          </div>
        </div>
        <div id="tab-2" class="tab-pane">
          <div class="swiper-products-1 overflow-h mt-40">
            <div class="swiper-wrapper">

              <?php
                $args = array(
                    'post_type'      => 'product',
                    'posts_per_page' => 8,
                    'post_status'    => 'publish',
                    'post__in'       => array_merge( array( 0 ), wc_get_product_ids_on_sale() )
                );

                $products = new WP_Query($args);

                if ($products->have_posts()) {
                  while ($products->have_posts()) {
                    $products->the_post();
                    global $product;
                    $product_id    = $product->get_id();
                    $price_regular = $product->get_regular_price();
                    $price_sale    = $product->get_sale_price();
                    $price_display = $product->get_price_html();
                    $product_link  = get_permalink($product->get_id());
                    $thumbnail     = get_the_post_thumbnail_url($product_id, 'medium');
                    ?>
                    <div class="swiper-slide">
                      <div class="card">
                        
                        <a class="wrap-img" href="<?php the_permalink(); ?>">
                            <img src="<?php echo esc_url( wp_get_attachment_url( $product->get_image_id() ) ); ?>" alt="<?php the_title(); ?>">
                        </a>
                        
                        <div class="product-card__info p-20">
                          <div class="product-card__title"><?php the_title(); ?></div>
                          <div class="product-card__bottom">
                            <div class="product-card__price price pt-20">
                              <?php
                                if ($product->is_type('variable')) {
                                  $prices = $product->get_variation_prices(true);

                                  // Минимальные цены
                                  $min_regular_price = current($prices['regular_price']);
                                  $min_sale_price    = current($prices['sale_price']);

                                  // Если есть скидка
                                  if ($min_sale_price && $min_sale_price < $min_regular_price) {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($min_sale_price) . '</div>';
                                    echo '<del class="price-old">' . wc_price($min_regular_price) . '</del>';
                                    echo '</span>';
                                  } else {
                                    // Без скидки
                                    echo '<span class="price">' . wc_price($min_regular_price) . '</span>';
                                  }

                                } else {
                                  // Для простых товаров
                                  if ($product->is_on_sale()) {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_sale_price()) . '</div>';
                                    echo '<del class="price-old">' . wc_price($product->get_regular_price()) . '</del> ';
                                    echo '</span>';
                                  } else {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_regular_price()) . '</div>';
                                    echo '<del class="price-old"></del> ';
                                    echo '</span>';
                                  }
                                }
                              ?>
                            </div>
                          </div>
                        </div>
                        <div><a class="btn-1" href="<?php the_permalink(); ?>">Подробнее</a></div>
                      </div>
                    </div>
                    <?php  
                  }
                  
                  wp_reset_postdata(); // Сбрасываем данные запроса
                    
                } else {
                  echo '<p>Товары не найдены</p>';
                }

                wp_reset_postdata();
              ?>

            </div>
          </div>
        </div>
        <div id="tab-3" class="tab-pane">
          <div class="swiper-products-1 overflow-h mt-40">
            <div class="swiper-wrapper">

              <?php
                // Получаем товары WooCommerce
                $args = array(
                    'post_type'      => 'product',
                    'posts_per_page' => 8, // сколько товаров вывести
                    'post_status'    => 'publish',
                    'tax_query'      => array(
                        array(
                            'taxonomy' => 'product_cat',
                            'field'    => 'slug',
                            'terms'    => 'premium',
                        ),
                    ),
                );

                $products = new WP_Query($args);

                if ($products->have_posts()) {
                  while ($products->have_posts()) {
                    $products->the_post();
                    global $product;
                    $product_id    = $product->get_id();
                    $price_regular = $product->get_regular_price();
                    $price_sale    = $product->get_sale_price();
                    $price_display = $product->get_price_html();
                    $product_link  = get_permalink($product->get_id());
                    $thumbnail     = get_the_post_thumbnail_url($product_id, 'medium');
                    ?>
                    <div class="swiper-slide">
                      <div class="card">
                        
                        <a class="wrap-img" href="<?php the_permalink(); ?>">
                            <img src="<?php echo esc_url( wp_get_attachment_url( $product->get_image_id() ) ); ?>" alt="<?php the_title(); ?>">
                        </a>
                        
                        <div class="product-card__info p-20">
                          <div class="product-card__title"><?php the_title(); ?></div>
                          <div class="product-card__bottom">
                            <div class="product-card__price price pt-20">
                              <?php
                                if ($product->is_type('variable')) {
                                  $prices = $product->get_variation_prices(true);

                                  // Минимальные цены
                                  $min_regular_price = current($prices['regular_price']);
                                  $min_sale_price    = current($prices['sale_price']);

                                  // Если есть скидка
                                  if ($min_sale_price && $min_sale_price < $min_regular_price) {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($min_sale_price) . '</div>';
                                    echo '<del class="price-old">' . wc_price($min_regular_price) . '</del>';
                                    echo '</span>';
                                  } else {
                                    // Без скидки
                                    echo '<span class="price">' . wc_price($min_regular_price) . '</span>';
                                  }

                                } else {
                                  // Для простых товаров
                                  if ($product->is_on_sale()) {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_sale_price()) . '</div>';
                                    echo '<del class="price-old">' . wc_price($product->get_regular_price()) . '</del> ';
                                    echo '</span>';
                                  } else {
                                    echo '<span class="price flex f-jc-sb f-ai-b">';
                                    echo '<div class="price-new"><span class="fs-14">от</span>&nbsp;' . wc_price($product->get_regular_price()) . '</div>';
                                    echo '<del class="price-old"></del> ';
                                    echo '</span>';
                                  }
                                }
                              ?>
                            </div>
                          </div>
                        </div>
                        <div><a class="btn-1" href="<?php the_permalink(); ?>">Подробнее</a></div>
                      </div>
                    </div>
                    <?php  
                  }
                  
                  wp_reset_postdata(); // Сбрасываем данные запроса
                    
                } else {
                  echo '<p>Товары не найдены</p>';
                }

                wp_reset_postdata();
              ?>

            </div>
          </div>
        </div>
      </div>
    </div>
    
    
    <a href="/shop" class="btn ff-inter-700 mt-60 uppercase">Перейти в каталог</a>
  </section>

  <section id="our-works">  <!-- Block : Works  -->
    <h2 class="cercle bg-gray">Наши работы</h2>

    <div class="swiper-articles overflow-h mt-60">
      <div class="swiper-wrapper">
        
        <?php $works_args = [
            'post_type'      => 'our_works',
            'posts_per_page' => 6,
            'orderby'        => 'date',
            'order'          => 'DESC'
          ];
            
          $works_query = new WP_Query($works_args);

          if ($works_query->have_posts()) :
            while ($works_query->have_posts()) : $works_query->the_post();
              $price = get_post_meta(get_the_ID(), '_tombstone_work_price', true);
              ?>
              <article class="swiper-slide">
                <div class="article">
                  <?php if (has_post_thumbnail()) : ?>
                          <div class="work-thumbnail-home">
                              <!-- <a href="<?php the_permalink(); ?>"> -->
                                  <?php the_post_thumbnail('hight', ['class' => 'work-image-home']); ?>
                              <!-- </a> -->
                          </div>
                      <?php endif; ?>
                  <div class="info p-20">
                    <a class="aritcle__title ff-inter-700 fs-24" href="<?php the_permalink(); ?>"><?php the_title(); ?></a>
                    <div class="article__desc ff-osc-l mt-20">
                      <?php 
                        if (has_excerpt()) { echo wp_trim_words(get_the_excerpt(), 30, '...'); } 
                        else               { echo wp_trim_words(get_the_content(), 30, '...'); } 
                      ?>
                    </div>
                    <div class="aritcle__price mt-30 ff-gogh-ex-bo fs-28 mt-40"><?php echo esc_html($price); ?>&nbsp;₽</div>
                  </div>
                  <!-- <a class="btn ff-inter-700" href="<?php the_permalink(); ?>">Подробнее</a> -->
                </div>
              </article>
            <?php
            endwhile;
              wp_reset_postdata();
            else :
                echo '<p>Работы пока не добавлены.</p>';
            endif;
        ?>

      </div>
    </div>
    <a href="<?php echo get_post_type_archive_link('our_works'); ?>" class="btn-1 mt-20 uppercase button-with-arrow ff-inter-700" >Смотреть все работы</a>
  </section>

  <section class="mt-60">
    <a href="#" class="btn-1 uppercase btn-bg-orange button-with-arrow ff-inter-700" >Конструктор</a>
    <h3 class="pt-10 fs-44">Воспользуйтесь КОНСТРУКТОРОМ, чтобы рассчитать примерную стоимость мемориала</h3>
  </section>

  <? get_template_part( 'template-parts/work-stages-b', 'block' ); ?>

  <section id="reviews" class="mt-60">  <!-- Block : Testimonials -->
    <h2 class="cercle bg-gray">Отзывы</h2>

    <div class="swiper-reviews overflow-h mt-60">
      <div class="swiper-wrapper">

      <?php $reviews_args = [
        'post_type' => 'testimonials'
        // 'posts_per_page' => 6,
        // 'orderby'        => 'date',
        // 'order'          => 'DESC'
      ];
      
      $reviews_query = new WP_Query($reviews_args);

      if ($reviews_query->have_posts()) :
        while ($reviews_query->have_posts()) : $reviews_query->the_post();
          $author_name      = get_post_meta(get_the_ID(), '_tombstone_testimonial_author_name', true);
          $testimonial_date = get_post_meta(get_the_ID(), '_tombstone_testimonial_date', true);
          $testimonial_link = get_post_meta(get_the_ID(), '_tombstone_testimonial_link', true);
        ?>

          <review class="swiper-slide">
            <div class="review">
                  <?php if (has_post_thumbnail()) : ?>
                          <div class="testimonial-thumbnail-home">
                              <!-- <a href="<?php the_permalink(); ?>"> -->
                                  <?php the_post_thumbnail('large', ['class' => 'work-image-home']); ?>
                              <!-- </a> -->
                          </div><?php
                        else : ?>
                          <div class="flex f-jc-с p-92-24 bg-gray-3 txt-white ff-inter-800 fs-36 uppercase">Фото отсутствует</div>
                      <?php endif; ?>
              <div class="info p-20">
                <div class="flex f-jc-sb">
                  <div class="review__title ff-inter-700 fs-24"><?php echo $author_name;  ?></div>
                  <div class="review__date ff-inter-700 fs-24 opacity-4"><?php echo wp_date('j F Y', strtotime($testimonial_date)); ?></div>
                </div>
                <div class="review__desc ff-osc-l mt-20">
                  <?php 
                    if (has_excerpt()) { echo wp_trim_words(get_the_excerpt(), 26, '...'); } 
                    else               { echo wp_trim_words(get_the_content(), 26, '...'); } 
                  ?>
                </div>
              </div>
              <? if (!empty($testimonial_link)) : ?> 
                <a href="<? echo $testimonial_link ?>" target="_blank" class="btn ff-inter-700">Читать в 2Гис</a>
              <? endif; ?>
              
              
            </div>
          </review>
        
        <?php
        endwhile;
          wp_reset_postdata();
      else :
          echo '<p>Отзывов пока нет.</p>';
      endif;
    ?>
      
        
        <div class="swiper-slide">
          <div class="review">
            <img src="<?php echo get_stylesheet_directory_uri() . '/assets/images/stock-tombstone.jpg' ?>" alt="">
            <div class="info p-20">
              <div class="flex f-jc-sb">
                <div class="review__title ff-inter-700 fs-24">Ирина</div>
                <div class="review__date ff-inter-700 fs-24 opacity-4">20 июня 2025</div>
              </div>
              <div class="review__desc ff-osc-l mt-20">Добрый день! Хочу оставить положительный отзыв о проделанной работе специалистов своего дела. Много объездили фирм по изготовлению памятников, но вернулись в мастерскую камня "Монумент". Заказывали здесь памятник папе...</div>
            </div>
            <a href="" class="btn ff-inter-700">Читать в 2Гис</a>
          </div>
        </div>

      </div>
    </div>
      
  </section>

 <? get_template_part( 'template-parts/call-to-action-1', 'block' ) ?>


<script src="<?php echo get_stylesheet_directory_uri() . '/assets/js/swiper-bundle.min.js' ?>"></script>
<script>
  var swiper = new Swiper(".swiper", {
    autoHeight: true,
    centeredSlides: true,
    loop: true,
    pagination: {
    el: '.dots',
    clickable: true,
    },
    navigation: {
      nextEl: ".swiper-button-next",
      prevEl: ".swiper-button-prev",
    },
  });

  var swiperProducts1 = new Swiper(".swiper-products-1", {
    slidesPerView: 5,
    spaceBetween: 40,
    freeMode: true,
    breakpoints: {
      320: {slidesPerView: 2,spaceBetween: 5},
      480: {slidesPerView: 3,spaceBetween: 10},
      640: {slidesPerView: 5,spaceBetween: 40}
    }
  });

  var swiperProducts2 = new Swiper(".swiper-products-2", {
    slidesPerView: 4, spaceBetween: 40,
    grid: { rows: 2 },
    pagination: {el: ".swiper-pagination", clickable: true},
    breakpoints: {
      320: {slidesPerView: 2,spaceBetween: 5},
      480: {slidesPerView: 3,spaceBetween: 10},
      640: {slidesPerView: 5,spaceBetween: 40}
    }
  });

  var swiperArticles = new Swiper(".swiper-articles", {
    slidesPerView: 2, spaceBetween: 40, freeMode: true,
    breakpoints: {
      320: {slidesPerView: 1,spaceBetween: 5},
      480: {slidesPerView: 2,spaceBetween: 10},
      640: {slidesPerView: 2,spaceBetween: 40}
    }
  });

  var swiperArticles = new Swiper(".swiper-reviews", {
    slidesPerView: 2, spaceBetween: 40, freeMode: true,
    breakpoints: {
      320: {slidesPerView: 1,spaceBetween: 5},
      480: {slidesPerView: 2,spaceBetween: 10},
      640: {slidesPerView: 2,spaceBetween: 40}
    }
  });


  document.addEventListener("DOMContentLoaded", function () {
    document.querySelectorAll('.tabs').forEach((el) => {
      let tabLinks = el.querySelectorAll(".tab-link"); 
      let tabPanes = el.querySelectorAll(".tab-pane");

      tabLinks.forEach((btn, index) => {
        btn.addEventListener("click", () => {
          tabLinks.forEach((b) => b.classList.remove("active"));
          tabPanes.forEach((pane) => pane.classList.remove("active"));

          // Активируем выбранные по индексу
          btn.classList.add("active");
          tabPanes[index].classList.add("active");
        });
      });
    });



  });
</script>

<?php get_footer(); ?>